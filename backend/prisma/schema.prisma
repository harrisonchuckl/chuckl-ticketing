// ----------------------
// Refund (updated block)
// ----------------------
model Refund {
  id          String   @id @default(cuid())

  orderId     String
  order       Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)

  /// Amount in pence (column mapped to amountPence)
  amount      Int      @map("amountPence")

  reason      String?
  processorId String?
  stripeId    String?

  // NEW - matches route usage
  createdBy   String?

  createdAt   DateTime @default(now())

  @@index([orderId])
}

// ----------------------
// SeatMap (updated block)
// ----------------------
model SeatMap {
  id        String   @id @default(cuid())
  showId    String?
  show      Show?    @relation(fields: [showId], references: [id])
  venueId   String?
  venue     Venue?   @relation(fields: [venueId], references: [id])

  name      String
  version   Int?
  // NEW - matches route usage
  isDefault Boolean  @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  seats       Seat[]
  allocations ExternalAllocation[]
  zones       SeatMapZone[]

  @@index([showId])
  @@index([venueId])
}

// ------------------------------------
// ExternalAllocation (updated block)
// ------------------------------------
model ExternalAllocation {
  id        String   @id @default(cuid())

  showId    String?
  show      Show?    @relation(fields: [showId], references: [id])

  seatMapId String
  seatMap   SeatMap  @relation(fields: [seatMapId], references: [id])

  label     String

  // NEW - optional platform hint (e.g., "SeeTickets", "Ticketsolve")
  externalPlatform String?

  createdAt DateTime @default(now())

  seats AllocationSeat[]

  @@index([seatMapId])
  @@index([showId])
}

// ------------------------------------
// AllocationSeat (ensure seatNumber is STRING)
// ------------------------------------
model AllocationSeat {
  id           String   @id @default(cuid())
  seatId       String
  allocationId String

  allocation   ExternalAllocation @relation(fields: [allocationId], references: [id], onDelete: Cascade)

  rowLabel   String?
  seatNumber String?  // <- keep as string to support labels like "A12"
  level      String?

  createdAt  DateTime @default(now())

  @@index([allocationId])
  @@index([seatId])
}
