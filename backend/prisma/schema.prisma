// =========================
// Seating maps & show seats
// =========================

enum SeatStatus {
  AVAILABLE
  UNAVAILABLE
  HELD
  RESERVED
  SOLD
  EXTERNAL_ALLOCATED
}

model SeatmapTemplate {
  id        String            @id @default(cuid())
  venueId   String
  venue     Venue             @relation(fields: [venueId], references: [id])
  name      String
  sections  SeatmapSection[]
  createdAt DateTime          @default(now())
  updatedAt DateTime          @updatedAt
}

model SeatmapSection {
  id         String           @id @default(cuid())
  templateId String
  template   SeatmapTemplate  @relation(fields: [templateId], references: [id])

  name      String
  level     String?
  sortIndex Int               @default(0)
  originX   Int               @default(0)
  originY   Int               @default(0)

  seats     SeatTemplate[]
}

model SeatTemplate {
  id        String          @id @default(cuid())
  sectionId String
  section   SeatmapSection  @relation(fields: [sectionId], references: [id])

  rowLabel  String
  seatNumber Int
  label     String
  x         Int
  y         Int
  w         Int              @default(18)
  h         Int              @default(18)
  tags      Json?

  @@index([sectionId])
}

model ShowSeat {
  id        String     @id @default(cuid())
  showId    String
  show      Show       @relation(fields: [showId], references: [id])

  section    String?
  rowLabel   String
  seatNumber Int
  label      String
  x          Int
  y          Int
  w          Int        @default(18)
  h          Int        @default(18)

  status        SeatStatus @default(AVAILABLE)
  allocationRef String?

  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt

  @@unique([showId, label])
  @@index([showId, status])
}
