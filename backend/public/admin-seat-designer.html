<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Seat Map Designer – TickIn Admin</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      :root {
        --bg-page: #f4f5f7;
        --bg-panel: #ffffff;
        --bg-canvas: #ffffff;
        --border-soft: #d6d9e0;
        --text-main: #1f2933;
        --text-muted: #6b7380;
        --accent: #ff6b35;
        --accent-soft: rgba(255, 107, 53, 0.08);
        --seat: #d3d7df;
        --seat-border: #b7bcc8;
        --seat-hover: #ff6b35;
        --seat-selected: #111827;
        --shadow-soft: 0 10px 25px rgba(15, 23, 42, 0.08);
        --radius-lg: 16px;
      }

      * {
        box-sizing: border-box;
      }

      html,
      body {
        margin: 0;
        padding: 0;
        height: 100%;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        color: var(--text-main);
        background: var(--bg-page);
      }

      body {
        display: flex;
        flex-direction: column;
      }

      .sd-header {
        padding: 14px 20px;
        border-bottom: 1px solid #e2e4ea;
        background: #ffffff;
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      .sd-header-left {
        display: flex;
        flex-direction: column;
        gap: 4px;
      }

      .sd-header-title {
        font-size: 16px;
        font-weight: 600;
      }

      .sd-header-sub {
        font-size: 12px;
        color: var(--text-muted);
      }

      .sd-header-right {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .sd-chip {
        font-size: 11px;
        padding: 4px 8px;
        border-radius: 999px;
        background: #f3f4f6;
        color: var(--text-muted);
      }

      .sd-btn {
        border-radius: 999px;
        border: none;
        padding: 8px 16px;
        font-size: 13px;
        font-weight: 500;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 6px;
      }

      .sd-btn-secondary {
        background: #ffffff;
        border: 1px solid #d4d7e2;
        color: var(--text-main);
      }

      .sd-btn-primary {
        background: var(--accent);
        color: #ffffff;
        box-shadow: 0 8px 18px rgba(255, 107, 53, 0.35);
      }

      .sd-main {
        flex: 1;
        display: grid;
        grid-template-columns: 320px minmax(0, 1fr);
        height: calc(100% - 52px);
      }

      .sd-sidebar {
        border-right: 1px solid #e2e4ea;
        background: #ffffff;
        padding: 20px 18px 18px;
        overflow-y: auto;
      }

      .sd-stepper {
        display: flex;
        flex-direction: column;
        gap: 16px;
      }

      .sd-step {
        display: flex;
        align-items: flex-start;
        gap: 10px;
      }

      .sd-step-number {
        width: 22px;
        height: 22px;
        flex-shrink: 0;
        border-radius: 999px;
        border: 2px solid #d4d7e2;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 11px;
        font-weight: 600;
        color: var(--text-muted);
        background: #ffffff;
      }

      .sd-step-number.active {
        border-color: var(--accent);
        background: var(--accent-soft);
        color: var(--accent);
      }

      .sd-step-body {
        flex: 1;
      }

      .sd-step-title {
        font-size: 13px;
        font-weight: 600;
        margin-bottom: 2px;
      }

      .sd-step-desc {
        font-size: 12px;
        color: var(--text-muted);
        margin-bottom: 8px;
      }

      .sd-layout-grid {
        display: grid;
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: 8px;
        margin-top: 6px;
      }

      .sd-layout-card {
        border-radius: 10px;
        border: 1px solid #e2e4ea;
        background: #fafbff;
        padding: 10px 10px 9px;
        font-size: 12px;
        cursor: pointer;
        display: flex;
        flex-direction: column;
        gap: 4px;
      }

      .sd-layout-card.selected {
        border-color: var(--accent);
        background: var(--accent-soft);
      }

      .sd-layout-name {
        font-weight: 600;
      }

      .sd-layout-hint {
        font-size: 11px;
        color: var(--text-muted);
      }

      .sd-fields {
        display: grid;
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: 8px;
        margin-top: 8px;
      }

      .sd-field {
        display: flex;
        flex-direction: column;
        gap: 4px;
      }

      .sd-label {
        font-size: 11px;
        color: var(--text-muted);
      }

      .sd-input {
        border-radius: 8px;
        border: 1px solid #d4d7e2;
        padding: 6px 8px;
        font-size: 12px;
        width: 100%;
      }

      .sd-input:focus {
        outline: none;
        border-color: var(--accent);
        box-shadow: 0 0 0 1px var(--accent-soft);
      }

      .sd-footer-note {
        font-size: 11px;
        color: var(--text-muted);
        margin-top: 10px;
      }

      .sd-divider {
        height: 1px;
        background: #edf0f5;
        margin: 14px 0;
      }

      .sd-sidebar-actions {
        margin-top: 6px;
        display: flex;
        gap: 8px;
      }

      .sd-canvas-wrap {
        background: var(--bg-page);
        padding: 16px;
      }

      .sd-canvas-card {
        height: 100%;
        border-radius: var(--radius-lg);
        background: var(--bg-canvas);
        box-shadow: var(--shadow-soft);
        padding: 16px;
        display: flex;
        flex-direction: column;
      }

      .sd-canvas-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
      }

      .sd-canvas-title {
        font-size: 13px;
        font-weight: 600;
      }

      .sd-canvas-tools {
        display: flex;
        gap: 6px;
        align-items: center;
        font-size: 11px;
        color: var(--text-muted);
      }

      .sd-chip-ghost {
        border-radius: 999px;
        padding: 4px 8px;
        background: #f3f4f6;
      }

      .sd-canvas-inner {
        flex: 1;
        border-radius: 12px;
        border: 1px dashed #e0e3ec;
        padding: 16px;
        display: flex;
        flex-direction: column;
        gap: 10px;
        overflow: auto;
      }

      .sd-stage {
        align-self: center;
        width: 260px;
        max-width: 80%;
        height: 32px;
        border-radius: 999px;
        background: #111827;
        color: #f9fafb;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 11px;
        letter-spacing: 0.08em;
        text-transform: uppercase;
      }

      .sd-sections-row {
        display: flex;
        flex-direction: column;
        gap: 8px;
        margin-top: 10px;
      }

      .sd-section {
        display: flex;
        justify-content: center;
        gap: 32px;
      }

      .sd-seat-row {
        display: flex;
        gap: 4px;
        margin-bottom: 2px;
      }

      .sd-seat {
        width: 16px;
        height: 16px;
        border-radius: 999px;
        background: var(--seat);
        border: 1px solid var(--seat-border);
        cursor: pointer;
        transition: transform 0.08s ease, background 0.08s ease,
          border-color 0.08s ease;
      }

      .sd-seat:hover {
        transform: scale(1.1);
        border-color: var(--seat-hover);
      }

      .sd-seat.selected {
        background: var(--seat-selected);
        border-color: var(--seat-selected);
      }

      .sd-seat-row-label {
        font-size: 10px;
        color: var(--text-muted);
        width: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .sd-section-label {
        text-align: center;
        font-size: 10px;
        color: var(--text-muted);
        margin-top: 2px;
      }

      .sd-tables-wrap {
        margin-top: 16px;
        display: flex;
        flex-direction: column;
        gap: 12px;
        align-items: center;
      }

      .sd-table-row {
        display: flex;
        gap: 16px;
      }

      .sd-table {
        width: 54px;
        height: 54px;
        border-radius: 999px;
        border: 1px dashed #d4d7e2;
        position: relative;
      }

      .sd-table-seat {
        width: 10px;
        height: 10px;
        border-radius: 999px;
        background: var(--seat);
        border: 1px solid var(--seat-border);
        position: absolute;
        transform: translate(-50%, -50%);
      }

      .sd-empty-hint {
        font-size: 12px;
        color: var(--text-muted);
        text-align: center;
        margin-top: 40px;
      }

      @media (max-width: 900px) {
        .sd-main {
          grid-template-columns: minmax(0, 1fr);
        }

        .sd-sidebar {
          border-right: none;
          border-bottom: 1px solid #e2e4ea;
        }
      }
    </style>
  </head>
  <body>
    <header class="sd-header">
      <div class="sd-header-left">
        <div class="sd-header-title">Seat Map Designer</div>
        <div class="sd-header-sub">
          Step-by-step builder to create layouts for your event.
        </div>
      </div>
      <div class="sd-header-right">
        <div class="sd-chip">Draft layout</div>
        <button class="sd-btn sd-btn-secondary" id="sd-back-btn">
          ← Back to tickets
        </button>
        <button class="sd-btn sd-btn-primary" id="sd-save-btn">
          Save seat map
        </button>
      </div>
    </header>

    <main class="sd-main">
      <aside class="sd-sidebar">
        <div class="sd-stepper">
          <!-- STEP 1 -->
          <div class="sd-step">
            <div class="sd-step-number active" data-step-num="1">1</div>
            <div class="sd-step-body">
              <div class="sd-step-title">Choose layout type</div>
              <div class="sd-step-desc">
                Start by picking the style that best matches your room.
              </div>
              <div class="sd-layout-grid">
                <button
                  class="sd-layout-card"
                  data-layout="tables"
                  type="button"
                >
                  <div class="sd-layout-name">Tables &amp; chairs</div>
                  <div class="sd-layout-hint">Cabaret / club style</div>
                </button>
                <button
                  class="sd-layout-card"
                  data-layout="sections"
                  type="button"
                >
                  <div class="sd-layout-name">Sections &amp; rows</div>
                  <div class="sd-layout-hint">Theatre seating</div>
                </button>
                <button
                  class="sd-layout-card"
                  data-layout="mixed"
                  type="button"
                >
                  <div class="sd-layout-name">Mixed seating</div>
                  <div class="sd-layout-hint">Rows &amp; tables</div>
                </button>
                <button
                  class="sd-layout-card"
                  data-layout="blank"
                  type="button"
                >
                  <div class="sd-layout-name">Blank canvas</div>
                  <div class="sd-layout-hint">Build from scratch</div>
                </button>
              </div>
            </div>
          </div>

          <div class="sd-divider"></div>

          <!-- STEP 2 -->
          <div class="sd-step">
            <div class="sd-step-number" data-step-num="2">2</div>
            <div class="sd-step-body">
              <div class="sd-step-title">Set your numbers</div>
              <div class="sd-step-desc">
                Tell us roughly how many rows, seats or tables you need. You can
                tweak later.
              </div>

              <!-- fields for SECTIONS/ROWS -->
              <div
                class="sd-fields"
                id="sd-fields-sections"
                style="display: none"
              >
                <div class="sd-field">
                  <label class="sd-label" for="sections-count"
                    >Number of sections</label
                  >
                  <input
                    class="sd-input"
                    id="sections-count"
                    type="number"
                    min="1"
                    value="3"
                  />
                </div>
                <div class="sd-field">
                  <label class="sd-label" for="rows-per-section"
                    >Rows per section</label
                  >
                  <input
                    class="sd-input"
                    id="rows-per-section"
                    type="number"
                    min="1"
                    value="6"
                  />
                </div>
                <div class="sd-field">
                  <label class="sd-label" for="seats-per-row"
                    >Seats per row</label
                  >
                  <input
                    class="sd-input"
                    id="seats-per-row"
                    type="number"
                    min="1"
                    value="12"
                  />
                </div>
                <div class="sd-field">
                  <label class="sd-label">Total (auto)</label>
                  <input
                    class="sd-input"
                    id="sections-total"
                    type="text"
                    value=""
                    disabled
                  />
                </div>
              </div>

              <!-- fields for TABLES -->
              <div
                class="sd-fields"
                id="sd-fields-tables"
                style="display: none"
              >
                <div class="sd-field">
                  <label class="sd-label" for="tables-count"
                    >Number of tables</label
                  >
                  <input
                    class="sd-input"
                    id="tables-count"
                    type="number"
                    min="1"
                    value="10"
                  />
                </div>
                <div class="sd-field">
                  <label class="sd-label" for="seats-per-table"
                    >Seats per table</label
                  >
                  <input
                    class="sd-input"
                    id="seats-per-table"
                    type="number"
                    min="1"
                    value="8"
                  />
                </div>
                <div class="sd-field">
                  <label class="sd-label">Total (auto)</label>
                  <input
                    class="sd-input"
                    id="tables-total"
                    type="text"
                    disabled
                  />
                </div>
              </div>

              <p class="sd-footer-note">
                Once generated, you’ll still be able to click individual seats
                to disable or re-enable them.
              </p>

              <div class="sd-sidebar-actions">
                <button
                  class="sd-btn sd-btn-secondary"
                  type="button"
                  id="sd-clear-btn"
                >
                  Clear layout
                </button>
                <button
                  class="sd-btn sd-btn-primary"
                  type="button"
                  id="sd-generate-btn"
                >
                  Generate layout
                </button>
              </div>
            </div>
          </div>
        </div>
      </aside>

      <section class="sd-canvas-wrap">
        <div class="sd-canvas-card">
          <div class="sd-canvas-header">
            <div class="sd-canvas-title">Layout preview</div>
            <div class="sd-canvas-tools">
              <span class="sd-chip-ghost">Click seats to toggle</span>
              <span class="sd-chip-ghost">White background</span>
            </div>
          </div>
          <div id="sd-canvas" class="sd-canvas-inner">
            <div class="sd-empty-hint" id="sd-empty-hint">
              Choose a layout type on the left, enter your numbers and click
              <strong>Generate layout</strong> to get started.
            </div>
          </div>
        </div>
      </section>
    </main>

    <script>
      // --- Simple state ---
      const state = {
        layoutType: null, // "tables" | "sections" | "mixed" | "blank"
      };

      const layoutCards = document.querySelectorAll(".sd-layout-card");
      const stepNumbers = document.querySelectorAll(".sd-step-number");
      const sectionsFields = document.getElementById("sd-fields-sections");
      const tablesFields = document.getElementById("sd-fields-tables");
      const canvas = document.getElementById("sd-canvas");
      const emptyHint = document.getElementById("sd-empty-hint");

      const sectionsCountInput = document.getElementById("sections-count");
      const rowsPerSectionInput = document.getElementById("rows-per-section");
      const seatsPerRowInput = document.getElementById("seats-per-row");
      const sectionsTotalInput = document.getElementById("sections-total");

      const tablesCountInput = document.getElementById("tables-count");
      const seatsPerTableInput = document.getElementById("seats-per-table");
      const tablesTotalInput = document.getElementById("tables-total");

      const generateBtn = document.getElementById("sd-generate-btn");
      const clearBtn = document.getElementById("sd-clear-btn");
      const backBtn = document.getElementById("sd-back-btn");
      const saveBtn = document.getElementById("sd-save-btn");

      function setActiveStep(step) {
        stepNumbers.forEach((el) => {
          const thisStep = Number(el.dataset.stepNum);
          el.classList.toggle("active", thisStep === step);
        });
      }

      function updateTotals() {
        if (state.layoutType === "sections" || state.layoutType === "mixed") {
          const s = Number(sectionsCountInput.value || "0");
          const r = Number(rowsPerSectionInput.value || "0");
          const c = Number(seatsPerRowInput.value || "0");
          sectionsTotalInput.value = s * r * c || "";
        }
        if (state.layoutType === "tables" || state.layoutType === "mixed") {
          const t = Number(tablesCountInput.value || "0");
          const sp = Number(seatsPerTableInput.value || "0");
          tablesTotalInput.value = t * sp || "";
        }
      }

      function selectLayout(layout) {
        state.layoutType = layout;
        layoutCards.forEach((card) => {
          card.classList.toggle(
            "selected",
            card.getAttribute("data-layout") === layout
          );
        });

        // Show/hide inputs depending on layout
        sectionsFields.style.display =
          layout === "sections" || layout === "mixed" ? "grid" : "none";
        tablesFields.style.display =
          layout === "tables" || layout === "mixed" ? "grid" : "none";

        setActiveStep(2);
        updateTotals();
      }

      layoutCards.forEach((card) => {
        card.addEventListener("click", () =>
          selectLayout(card.getAttribute("data-layout"))
        );
      });

      // Auto totals
      [
        sectionsCountInput,
        rowsPerSectionInput,
        seatsPerRowInput,
        tablesCountInput,
        seatsPerTableInput,
      ].forEach((el) =>
        el.addEventListener("input", () => {
          updateTotals();
        })
      );

      // Clear layout
      clearBtn.addEventListener("click", () => {
        while (canvas.firstChild) canvas.removeChild(canvas.firstChild);
        canvas.appendChild(emptyHint);
        emptyHint.style.display = "block";
      });

      // Generate layout
      generateBtn.addEventListener("click", () => {
        if (!state.layoutType) {
          alert("Choose a layout type first.");
          return;
        }

        while (canvas.firstChild) canvas.removeChild(canvas.firstChild);

        // Always add stage
        const stage = document.createElement("div");
        stage.className = "sd-stage";
        stage.textContent = "STAGE";
        canvas.appendChild(stage);

        if (state.layoutType === "sections" || state.layoutType === "mixed") {
          const sectionsWrap = document.createElement("div");
          sectionsWrap.className = "sd-sections-row";

          const sectionsCount = Number(sectionsCountInput.value || "0") || 1;
          const rowsPerSection =
            Number(rowsPerSectionInput.value || "0") || 3;
          const seatsPerRow = Number(seatsPerRowInput.value || "0") || 8;

          const rowsLabels = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");

          for (let row = 0; row < rowsPerSection; row++) {
            const sectionRow = document.createElement("div");
            sectionRow.className = "sd-section";

            for (let s = 0; s < sectionsCount; s++) {
              const block = document.createElement("div");
              const seatRow = document.createElement("div");
              seatRow.className = "sd-seat-row";

              const label = document.createElement("div");
              label.className = "sd-seat-row-label";
              label.textContent = rowsLabels[row] || "";
              seatRow.appendChild(label);

              for (let seatIndex = 0; seatIndex < seatsPerRow; seatIndex++) {
                const seat = document.createElement("div");
                seat.className = "sd-seat";
                seat.addEventListener("click", () => {
                  seat.classList.toggle("selected");
                });
                seatRow.appendChild(seat);
              }

              block.appendChild(seatRow);

              const sectionLabel = document.createElement("div");
              sectionLabel.className = "sd-section-label";
              sectionLabel.textContent = `Block ${String.fromCharCode(
                65 + s
              )}`;
              block.appendChild(sectionLabel);

              sectionRow.appendChild(block);
            }

            sectionsWrap.appendChild(sectionRow);
          }

          canvas.appendChild(sectionsWrap);
        }

        if (state.layoutType === "tables" || state.layoutType === "mixed") {
          const tablesWrap = document.createElement("div");
          tablesWrap.className = "sd-tables-wrap";

          const tablesCount = Number(tablesCountInput.value || "0") || 8;
          const seatsPerTable =
            Number(seatsPerTableInput.value || "0") || 8;

          const perRow = Math.min(6, tablesCount);
          const rows = Math.ceil(tablesCount / perRow);

          let tableIndex = 0;
          for (let r = 0; r < rows; r++) {
            const rowEl = document.createElement("div");
            rowEl.className = "sd-table-row";

            for (let c = 0; c < perRow && tableIndex < tablesCount; c++) {
              const table = document.createElement("div");
              table.className = "sd-table";

              for (let i = 0; i < seatsPerTable; i++) {
                const seat = document.createElement("div");
                seat.className = "sd-table-seat";
                const angle = (i / seatsPerTable) * Math.PI * 2;
                const radius = 26;
                const cx = 27 + Math.cos(angle) * radius;
                const cy = 27 + Math.sin(angle) * radius;
                seat.style.left = cx + "px";
                seat.style.top = cy + "px";
                seat.addEventListener("click", () => {
                  seat.classList.toggle("selected");
                });
                table.appendChild(seat);
              }

              rowEl.appendChild(table);
              tableIndex++;
            }

            tablesWrap.appendChild(rowEl);
          }

          canvas.appendChild(tablesWrap);
        }

        if (state.layoutType === "blank") {
          const hint = document.createElement("div");
          hint.className = "sd-empty-hint";
          hint.textContent =
            "Blank canvas: we’ll later let you add free-form seats, shapes and labels here.";
          canvas.appendChild(hint);
        }

        emptyHint.style.display = "none";
      });

      // Back to tickets – for now just go back in history
      backBtn.addEventListener("click", () => {
        if (window.history.length > 1) {
          window.history.back();
        } else {
          window.location.href = "/admin/ui";
        }
      });

      // Save – placeholder
      saveBtn.addEventListener("click", () => {
        alert(
          "Seat layout saved (frontend placeholder). We’ll wire this to your API next."
        );
      });

      // If an ?eventId= query param exists, we keep it for later API calls
      const params = new URLSearchParams(window.location.search);
      const eventId = params.get("eventId");
      if (eventId) {
        document.title = `Seat Map Designer – Event ${eventId}`;
      }
    </script>
  </body>
</html>
